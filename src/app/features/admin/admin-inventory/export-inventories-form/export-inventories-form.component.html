<h2 class="text-uppercase text-center fw-bold mt-3">{{ data.title }}</h2>
<div class="row">
  <div class="col-6"></div>
  <div class="col-6 text-end">
    <button class="btn btn-sm btn-outline-secondary" (click)="addRow()">Thêm dòng</button>
  </div>
</div>
<div class="pt-2">
  <form>
    <table class="table table-bordered">
      <thead>
        <tr class="text-uppercase bg-warning text-dark">
          <th scope="col" *ngFor="let colHeader of headerColumns">{{ colHeader }}</th>
        </tr>
      </thead>
      <tbody [formGroup]="exportForm">
        <ng-container formArrayName="rows" *ngFor="let row of rows.controls; let i=index">
          <tr [formGroupName]="i">
            <td>
              <input
                type="text"
                class="form-control"
                formControlName="bookTitle"
                [ngClass]="row.get('bookTitle')?.touched ? row.get('bookTitle')?.invalid ? 'is-invalid' : 'is-valid' : null"
                [ngClass]="row.get('bookStoreId')?.touched ? row.get('bookStoreId')?.invalid ? 'is-invalid' : 'is-valid' : null"
              >
              <div class="text-danger mt-1" *ngIf="rows.controls[i].get('bookTitle')?.touched">
                <span *ngIf="row.get('bookTitle')?.errors?.['required']">
                  * Vui lòng nhập Tiêu đề sách
                </span>
                <span *ngIf="row.get('bookTitle')?.errors?.['bookExists']">
                  * Sách không tồn tại
                </span>
              </div>
              <div class="text-danger" *ngIf="row.get('bookStoreId')?.errors?.['bookExistInStore']">
                * Sách không tồn tại trong hiệu sách đã chọn
              </div>
              <div *ngIf="row.get('bookTitle')?.status === 'PENDING'" class="fa fa-spinner fa-spin loader"></div>
            </td>
            <td>
              <select
                formControlName="bookStoreId"
                class="form-control"
                [ngClass]="(row.get('bookStoreId')?.touched) ? row.get('bookStoreId')?.invalid ? 'is-invalid' : 'is-valid' : null"
              >
                <option value=""><span class="text-danger">* Chọn hiệu sách</span></option>
                <option *ngFor="let bookStore of bookStoresList" [value]="bookStore.id">{{ bookStore.storeName }}</option>
              </select>
            </td>
            <td>
              <input
                type="number"
                class="form-control"
                formControlName="quantity"
                [ngClass]="(row.get('quantity')?.touched) ? row.get('quantity')?.invalid ? 'is-invalid' : 'is-valid' : null"
              >
              <div class="text-danger mt-1" *ngIf="rows.controls[i].get('quantity')?.touched">
                <span *ngIf="rows.controls[i].get('quantity')?.errors?.['required']">
                  * Vui lòng nhập Số lượng xuất
                </span>
                <span *ngIf="row.get('quantity')?.errors?.['min']">
                  * Số lượng xuất phải lớn hơn hoặc bằng 0
                </span>
                <span *ngIf="row.get('quantity')?.errors?.['validQuantity']">
                  * Hiệu sách không đủ số lượng, hiện có {{ availableQuantity }}
                </span>
              </div>
            </td>
            <td>
              <input
                type="date"
                class="form-control"
                formControlName="exportDate"
                [ngClass]="(row.get('exportDate')?.touched) ? row.get('exportDate')?.invalid ? 'is-invalid' : 'is-valid' : null"
              >
              <div class="text-danger mt-1" *ngIf="rows.controls[i].get('exportDate')?.touched">
                <span *ngIf="row.get('exportDate')?.errors?.['required']">
                  * Vui lòng nhập Ngày xuất
                </span>
                <span *ngIf="row.get('exportDate')?.errors?.['futureDate']">
                  * Ngày xuất không thể lớn hơn ngày hôm nay
                </span>
              </div>
            </td>
            <td>
              <input
                type="text"
                class="form-control"
                formControlName="exportNotes"
                style="padding-right: 5px;"
              >
              <div class="text-danger mt-1" *ngIf="row.get('exportNotes')?.touched">
                <span *ngIf="row.get('exportNotes')?.errors?.['maxLength']">
                  * Ghi chú xuất kho kho được quá 100 ký tự
                </span>
              </div>
            </td>
            <td>
              <button class="btn btn-danger" (click)="removeFormGroup(i)">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </td>
          </tr>
        </ng-container>
        <ng-container>
          <tr>
            <td colspan="7">
              <div class="row">
                <div class="col-12 text-center">
                  <button class="me-1 btn btn-outline-danger" mat-dialog-close="">Hủy</button>
                  <button class="btn btn-primary" [disabled]="exportForm.invalid" (click)="onSubmit()">Lấy</button>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </form>
</div>
